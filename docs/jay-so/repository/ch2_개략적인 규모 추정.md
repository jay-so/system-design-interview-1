# 2️⃣ 개략적인 규모 측정

- 개략적인 규모를 효과적으로 측정하려면 2의 제곱수, 응답지연 값, 그리고 가용성에 관계된 수치들을 이해하고 있으며, 해당 부분이 더 효과적으로 개선하는데 도움을 줍니다.

---

## 💙 2의 제곱수

---

- 분산 시스템에서 다루는 데이터 양의 엄청나게 커질 수 있으나, 해당 계산법은 기본을 크게 벗어나지 않습니다.
- 먼저, 제대로 된 계산 결과를 얻으려면 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선 알아야 합니다.
- ASCII 문자 하나가 차지하는 메모리 크기는 1 바이트이며, 이는 8 비트입니다.


### 👉🏻 사용되는 데이터 볼륨의 단위

| 2의  x 제곱 | 근사치 | 이름 | 축약형 |
| --- | --- | --- | --- |
| 10 | 1천 | 1킬로 바이트 | 1KB |
| 20 | 1백만 | 1메가 바이트 | 1MB |
| 30 | 10억 | 1기가 바이트 | 1GB |
| 40 | 1조 | 1테라 바이트 | 1TB |
| 50 | 1000조 | 1페타 바이트 | 1PB |


<br/>

## ⏳ 모든 프로그래머가 알아야 하는 응답 지연 값

---

### 👉🏻 구글에서 공개한 일반적인 컴퓨터에서의 연산 응답 지연 시간
- 메모리는 빠르지만, 디스크는 아직도 느리다.
- 디스크 탐색은 가능한 피하라
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능한 압축하라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고 받는데 시간이 걸린다.

| 연산명 | 시간 |
| --- | --- |
| L1 캐시 참조 | 0.5ns |
| 분기 예측 오류 | 5ns |
| L2 캐시 참조 | 7ns |
| 뮤텍스 락/ 언락 | 100ns |
| 주 메모리 참조 | 100ns |
| Zippy로 1KB 압축 | 10,000ns = 10us |
| 1Gbps 네트워크로 2KB 전송 | 20,000ns = 20us |
| 메모리에서 1MB 순차적으로 Read | 250,000ns = 250us |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간 | 500,000ns = 500us |
| 디스크 탐색(seek) | 10,000,000ns = 10ms |
| 네트워크에서 1MB 순차적으로 Read | 10,000,000ns = 10ms |
| 디스크에서 1MB 순차적으로 Read | 30,000,000ns = 30ms |
| 한 패킷의 캘리포니아에서부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns = 150ms |


![컴퓨터 연산들의 처리 속도.png](..%2F..%2F..%2Fimages%2Fjay-so%2F2%EC%9E%A5%2F%EC%BB%B4%ED%93%A8%ED%84%B0%20%EC%97%B0%EC%82%B0%EB%93%A4%EC%9D%98%20%EC%B2%98%EB%A6%AC%20%EC%86%8D%EB%8F%84.png)



<br/>

## 🧾 가용성에 관계된 수치들

---

- 고가용성이란 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 의미합니다.
- 고가영성을 표현하는 값은 퍼센트(Percent)로 표현하는데, 100%는 시스템이 단 한번도 중단된 적이 없었음을 의미합니다.
  - 대부분의 서비스는 99% ~ 100% 사잉의 값을 갖습니다.
- SLA(Service Level Agreement)는 서비스 사업자가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미합니다.
  - 해당 합의에는 서비스 사업자가 제공하는 서비스의 가용시간이 공식적으로 기술되어 있습니다.
  - 아마존, 구글, MS 등은 99% 이상의 SLA를 제공합니다.
- 가용시간은 관습적으로 숫자 9를 사용하여 표시하며, 9가 많을 수록 좋습니다.

### 👉🏻 9의 갯수와 시스템 장애 시간 사이의 관계

| 가용률 | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
| --- | --- | --- | --- | --- |
| 99% | 14.40분 | 1.68 시간 | 7.31시간 | 3.65일 |
| 99.9% | 1.44분 | 10.08 분 | 43.83분 | 8.77시간 |
| 99.99% | 8.64초 | 1.01 분 | 4.38분 | 52.60분 |
| 99.999% | 864.00 밀리초 | 6.05 초 | 26.30초 | 5.26분 |
| 99.9999% | 86.40 밀리초 | 604. 80 밀리초 | 2.63초 | 31.56초 |


<br/>

## 🔎 예제: 트위터 QPS와 저장소 요구량 측정

---

## 🎯 가정

---

- 월간 사용자는 3억명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗응 10% 정도이다.
- 데이터는 5년간 보관된다.

## 🏹 추정

---

- QPS(Query Per Second) 추정치
- 일간 능동 사용자(DAU) = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2 트위5 / 24시간 / 3600초 = 약 3500
- 최대 QPS(Peek QPS) = 2 * QPS = 약 7,000

미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기
    - tweet_id에 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어 저장소 요구량: 1.5억 * 2 * 10% * 1MB = 30TB/ 일
- 5년간 미디어를 보관하기 위한 저장소 요구량
    - 30TB * 365 * 5 = 약 55PB

<br/>

### 📖 Reference

---

[가상 면접 사례로 배우는 대규모 시스템 설계 기초](https://m.yes24.com/Goods/Detail/102819435)

[컴퓨터의 지연 속도 그림](https://gist.github.com/hellerbarde/2843375)